(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))a(o);new MutationObserver(o=>{for(const l of o)if(l.type==="childList")for(const d of l.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&a(d)}).observe(document,{childList:!0,subtree:!0});function n(o){const l={};return o.integrity&&(l.integrity=o.integrity),o.referrerPolicy&&(l.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?l.credentials="include":o.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function a(o){if(o.ep)return;o.ep=!0;const l=n(o);fetch(o.href,l)}})();function x(e,t){return window.go.app.App.AddCustomGame(e,t)}function M(e,t){return window.go.app.App.DeleteAccount(e,t)}function S(){return window.go.app.App.GetLaunchers()}function C(){return window.go.app.App.GetLibrary()}function G(e,t,n,a){return window.go.app.App.LaunchGame(e,t,n,a)}function T(e,t){return window.go.app.App.RemoveGame(e,t)}function k(e){return window.go.app.App.SaveEpicAccount(e)}function H(){return window.go.app.App.SelectExe()}function N(){return window.go.app.App.SelectImage()}function P(e,t){return window.go.app.App.SetGameImage(e,t)}function O(e,t){return window.go.app.App.SwitchToAccount(e,t)}function U(e,t,n){return window.go.app.App.ToggleGameAccountHidden(e,t,n)}function F(e){return window.go.app.App.ToggleGamePin(e)}function R(e,t,n,a){return window.go.app.App.UpdateAccountData(e,t,n,a)}function D(e,t,n,a){return window.go.app.App.UpdateGameNote(e,t,n,a)}let A=[],I={username:"",platform:"",gameId:""},E={username:"",platform:""},b="",g=null,y=null,s={platforms:["Steam","Epic","Riot","Custom","Torrent"],onlyInstalled:!1,onlyMac:!1,searchQuery:""};document.addEventListener("DOMContentLoaded",()=>{m()});window.switchTab=function(e){document.querySelectorAll(".view-section").forEach(t=>t.style.display="none"),document.querySelectorAll(".nav-item").forEach(t=>t.classList.remove("active")),e==="library"?(document.getElementById("view-library").style.display="block",m()):(document.getElementById("view-accounts").style.display="block",w())};window.closeModal=function(e){document.getElementById(e).style.display="none"};window.openAddGameModal=function(){document.getElementById("add-game-modal").style.display="flex"};async function m(){try{A=await C()||[],applyFilters()}catch(e){console.error("Ошибка загрузки библиотеки:",e)}}window.toggleFilter=function(e,t){e.classList.toggle("active");const n=t==="Custom"?["Custom","Torrent"]:[t];e.classList.contains("active")?n.forEach(a=>{s.platforms.includes(a)||s.platforms.push(a)}):s.platforms=s.platforms.filter(a=>!n.includes(a)),applyFilters()};window.toggleBooleanFilter=function(e){e.classList.toggle("active"),e.id==="filter-installed"&&(s.onlyInstalled=e.classList.contains("active")),e.id==="filter-macos"&&(s.onlyMac=e.classList.contains("active")),applyFilters()};window.applyFilters=function(){const e=document.getElementById("filter-search");s.searchQuery=e?e.value.toLowerCase():"";const t=A.filter(n=>{let a=n.platform;return!(!s.platforms.includes(a)||s.onlyInstalled&&!n.isInstalled||s.onlyMac&&!n.isMacSupported||s.searchQuery&&!n.name.toLowerCase().includes(s.searchQuery))});Q(t)};function Q(e){const t=document.getElementById("games-grid");if(t){if(t.innerHTML="",!e||e.length===0){t.innerHTML='<div style="color:#aaa; padding:20px; grid-column: 1/-1; text-align:center;">Игры не найдены по заданным фильтрам.</div>';return}e.forEach(n=>{const a=document.createElement("div");a.className="card",n.isInstalled||a.classList.add("game-not-installed"),a.setAttribute("data-id",n.id),a.setAttribute("data-platform",n.platform),a.onclick=()=>openGameModal(n.id);let o="#0074e4";n.platform==="Steam"&&(o="#1b2838"),n.platform==="Epic"&&(o="#333"),n.platform==="Riot"&&(o="#d13639"),(n.platform==="Custom"||n.platform==="Torrent")&&(o="#2d8c58");let l="https://via.placeholder.com/300x169?text="+encodeURIComponent(n.name);n.iconUrl&&(l=n.iconUrl.replace(/\\/g,"/"));const i=`<div class="pin-btn ${n.isPinned?"active":""}" onclick="window.togglePin(event, '${n.id}')"><i class="fa-solid fa-thumbtack"></i></div>`;let c="";n.isInstalled||(c='<div class="install-overlay"><i class="fa-solid fa-download"></i></div>');let r="";n.isMacSupported&&(r='<i class="fa-brands fa-apple" style="margin-right:5px;" title="macOS Supported"></i>'),a.innerHTML=`
            <div class="platform-badge" style="background:${o}">
                ${r}${n.platform}
            </div>
            ${i}
            ${c}
            <img src="${l}" class="card-img" style="height:150px; width:100%; object-fit:cover;">
            <div class="card-info">
                <div class="game-title" title="${n.name}">${n.name}</div>
            </div>
        `,t.appendChild(a)})}}window.togglePin=async function(e,t){e&&e.stopPropagation(),await F(t),m()};window.openGameModal=function(e){b=e;const t=document.getElementById("show-hidden-accs");t&&(t.checked=!1),v(e),document.getElementById("account-modal").style.display="flex"};window.refreshGameModal=function(){b&&v(b)};function v(e){const t=A.find(i=>i.id===e);if(!t)return;if(t.platform==="Custom"||t.platform==="Torrent"){launch("",t.id,t.platform,t.exePath),document.getElementById("account-modal").style.display="none";return}const n=t.isInstalled?"Launch":"Install",a=t.isInstalled?"fa-play":"fa-download",o=document.getElementById("show-hidden-accs"),l=o?o.checked:!1;document.getElementById("modal-game-title").innerText=`${n} ${t.name}`;const d=document.getElementById("modal-accounts-list");d.innerHTML="",!t.availableOn||t.availableOn.length===0?d.innerHTML=`<div class="modal-item interactable" onclick="launch('', '${t.id}', '${t.platform}', '')">
            <div class="acc-name">${n} Game</div>
            <div class="acc-meta">Current Account (or not logged in)</div>
        </div>`:t.availableOn.forEach(i=>{if(i.isHidden&&!l)return;const c=document.createElement("div");c.className="modal-item",i.isHidden&&c.classList.add("acc-hidden-row");let r="";i.note==="Main"?r='<span class="badge badge-main"><i class="fa-solid fa-crown"></i> MAIN</span>':i.note==="Smurf"?r='<span class="badge badge-smurf"><i class="fa-solid fa-child"></i> SMURF</span>':i.note==="VAC"?r='<span class="badge badge-vac"><i class="fa-solid fa-ban"></i> VAC BAN</span>':i.note&&(r=`<span class="badge badge-custom"><i class="fa-solid fa-note-sticky"></i> ${i.note}</span>`);const h=i.isHidden?"fa-rotate-left":"fa-eye-slash",L=i.isHidden?"toggle-restore-btn":"toggle-hidden-btn",B=i.isHidden?"Restore account":"Hide from this game";c.innerHTML=`
                <div style="flex:1; cursor:pointer;" onclick="launch('${i.username}', '${t.id}', '${t.platform}', '')">
                    <div class="acc-name" style="font-weight:bold; display:flex; align-items:center;">
                        <i class="fa-solid ${a}" style="margin-right:8px; font-size:12px; color:#aaa;"></i>
                        ${i.displayName}
                        ${r}
                    </div>
                    <div class="acc-meta" style="font-size:12px; color:#aaa;">Login: ${i.username}</div>
                </div>
                
                <div class="edit-note-btn" onclick="openNoteSelector('${i.username}', '${t.platform}', '${t.id}', '${i.note||""}')" title="Tag Account">
                    <i class="fa-solid fa-tag"></i>
                </div>
                
                <div class="toggle-hidden-btn ${L}" onclick="toggleGameAccountHidden('${i.username}', '${t.platform}', '${t.id}')" title="${B}">
                    <i class="fa-solid ${h}"></i>
                </div>
            `,d.appendChild(c)})}window.launch=async function(e,t,n,a){try{const o=await G(e,t,n,a);o&&!o.startsWith("Launched")&&!o.startsWith("Success")?alert(o):document.getElementById("account-modal").style.display="none"}catch(o){alert("Launch error: "+o)}};window.toggleGameAccountHidden=async function(e,t,n){await U(e,t,n),await m(),v(n)};window.openNoteSelector=function(e,t,n,a){I={username:e,platform:t,gameId:n};const o=["Main","Smurf","VAC"].includes(a);document.getElementById("custom-note-input").value=o?"":a,document.getElementById("note-select-modal").style.display="flex"};window.savePredefinedNote=async function(e){await $(e)};window.saveCustomNote=async function(){const e=document.getElementById("custom-note-input").value;await $(e)};async function $(e){const{username:t,platform:n,gameId:a}=I;await D(t,n,a,e),await m(),document.getElementById("note-select-modal").style.display="none",v(a)}async function w(){const e=document.getElementById("launchers-list");if(e){e.innerHTML='<div style="padding:20px">Loading accounts...</div>';try{const t=await S();if(e.innerHTML="",!t||t.length===0){e.innerHTML='<div style="padding:20px">No launchers found.</div>';return}t.forEach(n=>{const a=document.createElement("div");a.className="launcher-section";let o="";const l=n.accounts||[];l.forEach(c=>{let r=`<div class="acc-avatar">${c.displayName.charAt(0)}</div>`;c.avatarUrl&&(r=`<div class="acc-avatar" style="background-image: url('${c.avatarUrl.replace(/\\/g,"/")}'); background-size: cover; color: transparent;"></div>`);const h=c.comment?`<div class="acc-comment">${c.comment}</div>`:"";o+=`
                    <div class="account-row interactable" onclick="switchAccount('${c.username}', '${n.platform}')">
                        ${r}
                        <div class="acc-details">
                            <div class="acc-nick">${c.displayName}${h}</div>
                            <div class="acc-login">${c.username}</div>
                        </div>
                        <div class="acc-actions" onclick="event.stopPropagation()">
                            <div class="action-icon-btn" onclick="openEditAccount('${c.username}', '${n.platform}', '${c.comment||""}')"><i class="fa-solid fa-pen"></i></div>
                            <div class="action-icon-btn delete-btn" onclick="deleteAccount('${c.username}', '${n.platform}')"><i class="fa-solid fa-trash"></i></div>
                        </div>
                        <div class="acc-action-icon"><i class="fa-solid fa-arrow-right-to-bracket"></i></div>
                    </div>`});let d="";n.platform==="Epic"&&(d='<div style="padding:10px; text-align:center; border-top:1px solid #2a2a2a;"><button onclick="openEpicSaveModal()" style="cursor:pointer; background:none; color:#aaa; border:1px dashed #444; width:100%; padding:8px; border-radius:4px;"><i class="fa-solid fa-plus"></i> Add Current Epic Session</button></div>');let i="fa-gamepad";n.platform==="Steam"&&(i="fa-steam"),n.platform==="Epic"&&(i="fa-bolt"),a.innerHTML=`
                <div class="launcher-header">
                    <i class="fa-brands ${i}"></i> ${n.name} 
                    <span class="count">${l.length}</span>
                </div>
                <div class="launcher-accounts">${o}</div>
                ${d}
            `,e.appendChild(a)})}catch(t){e.innerHTML=`<div style="color:red; padding:20px;">Error loading accounts: ${t}</div>`,console.error("Load Accounts Error:",t)}}}window.switchAccount=async function(e,t){const n=await O(e,t);alert(n)};window.deleteAccount=async function(e,t){confirm(`Скрыть аккаунт ${e} из списка?`)&&(await M(e,t),w())};window.openEditAccount=function(e,t,n){E={username:e,platform:t},document.getElementById("edit-comment").value=n,document.getElementById("edit-avatar-path").value="",document.getElementById("edit-account-modal").style.display="flex"};window.selectNewAvatar=async function(){const e=await N();e&&(document.getElementById("edit-avatar-path").value=e)};window.saveAccountChanges=async function(){await R(E.username,E.platform,document.getElementById("edit-comment").value,document.getElementById("edit-avatar-path").value),closeModal("edit-account-modal"),w()};window.browseFile=async function(){const e=await H();e&&(document.getElementById("custom-path").value=e)};window.saveCustomGame=async function(){const e=await x(document.getElementById("custom-name").value,document.getElementById("custom-path").value);e==="Success"?(closeModal("add-game-modal"),m(),document.getElementById("custom-name").value="",document.getElementById("custom-path").value=""):alert(e)};window.openEpicSaveModal=function(){document.getElementById("epic-save-name").value="",document.getElementById("save-epic-modal").style.display="flex"};window.doSaveEpic=async function(){const e=document.getElementById("epic-save-name").value;if(!e){alert("Please enter a name");return}try{const t=await k(e);t==="Success"?(closeModal("save-epic-modal"),alert("Epic account saved!"),w()):alert("Error: "+t)}catch(t){alert("System error: "+t),console.error(t)}};const u=document.getElementById("context-menu"),f=document.getElementById("ctx-delete"),p=document.getElementById("ctx-change-icon");document.addEventListener("click",()=>{u&&(u.style.display="none")});document.addEventListener("contextmenu",e=>{const t=e.target.closest(".card");if(t){if(e.preventDefault(),g=t.getAttribute("data-id"),y=t.getAttribute("data-platform"),y==="Torrent"||y==="Custom")f&&(f.style.display="block"),p&&(p.style.display="block");else if(f&&(f.style.display="none"),p&&(p.style.display="none"),!f&&!p){u.style.display="none";return}u.style.top=`${e.pageY}px`,u.style.left=`${e.pageX}px`,u.style.display="block"}else u&&(u.style.display="none")});f&&f.addEventListener("click",async()=>{if(!(!g||!y||!confirm("Удалить эту игру из библиотеки?")))try{const t=await T(g,y);t==="Success"?m():alert("Ошибка: "+t)}catch(t){console.error(t)}});p&&p.addEventListener("click",async()=>{if(!g||!y)return;const e=await P(g,y);e&&!e.startsWith("Error")&&e!=="Cancelled"&&e!=="Not supported for this platform"?m():e&&e.startsWith("Error")&&alert(e)});
