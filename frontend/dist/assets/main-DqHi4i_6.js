(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))o(a);new MutationObserver(a=>{for(const s of a)if(s.type==="childList")for(const c of s.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&o(c)}).observe(document,{childList:!0,subtree:!0});function n(a){const s={};return a.integrity&&(s.integrity=a.integrity),a.referrerPolicy&&(s.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?s.credentials="include":a.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function o(a){if(a.ep)return;a.ep=!0;const s=n(a);fetch(a.href,s)}})();function G(t,e){return window.go.app.App.AddCustomGame(t,e)}function x(t,e){return window.go.app.App.DeleteAccount(t,e)}function M(){return window.go.app.App.GetLaunchers()}function b(){return window.go.app.App.GetLibrary()}function C(t,e,n,o){return window.go.app.App.LaunchGame(t,e,n,o)}function H(t,e){return window.go.app.App.RemoveGame(t,e)}function T(t){return window.go.app.App.SaveEpicAccount(t)}function k(){return window.go.app.App.SelectExe()}function S(){return window.go.app.App.SelectImage()}function N(t,e){return window.go.app.App.SetGameImage(t,e)}function P(t,e){return window.go.app.App.SwitchToAccount(t,e)}function O(t,e,n){return window.go.app.App.ToggleGameAccountHidden(t,e,n)}function U(t){return window.go.app.App.ToggleGamePin(t)}function D(t,e,n,o){return window.go.app.App.UpdateAccountData(t,e,n,o)}function R(t,e,n,o){return window.go.app.App.UpdateGameNote(t,e,n,o)}let g=[],A={username:"",platform:"",gameId:""},h={username:"",platform:""},E="",y=null,m=null;document.addEventListener("DOMContentLoaded",()=>{f()});window.switchTab=function(t){document.querySelectorAll(".view-section").forEach(e=>e.style.display="none"),document.querySelectorAll(".nav-item").forEach(e=>e.classList.remove("active")),t==="library"?(document.getElementById("view-library").style.display="block",f()):(document.getElementById("view-accounts").style.display="block",w())};window.closeModal=function(t){document.getElementById(t).style.display="none"};window.openAddGameModal=function(){document.getElementById("add-game-modal").style.display="flex"};async function f(){const t=document.getElementById("games-grid");if(t)try{const e=await b();if(g=e,t.innerHTML="",!e||e.length===0){t.innerHTML='<div style="color:#aaa; padding:20px;">Игры не найдены. Добавьте игру или сканируйте библиотеки.</div>';return}e.forEach(n=>{const o=document.createElement("div");o.className="card",n.isInstalled||o.classList.add("game-not-installed"),o.setAttribute("data-id",n.id),o.setAttribute("data-platform",n.platform),o.onclick=()=>openGameModal(n.id);let a="#0074e4";n.platform==="Steam"&&(a="#1b2838"),n.platform==="Epic"&&(a="#333"),n.platform==="Riot"&&(a="#d13639"),(n.platform==="Custom"||n.platform==="Torrent")&&(a="#2d8c58");let s="https://via.placeholder.com/300x169?text="+encodeURIComponent(n.name);n.iconUrl&&(s=n.iconUrl.replace(/\\/g,"/"));const i=`<div class="pin-btn ${n.isPinned?"active":""}" onclick="window.togglePin(event, '${n.id}')"><i class="fa-solid fa-thumbtack"></i></div>`;let l="";n.isInstalled||(l='<div class="install-overlay"><i class="fa-solid fa-download"></i></div>'),o.innerHTML=`
                <div class="platform-badge" style="background:${a}">${n.platform}</div>
                ${i}
                ${l}
                <img src="${s}" class="card-img" style="height:150px; width:100%; object-fit:cover;">
                <div class="card-info">
                    <div class="game-title" style="font-weight:bold;">${n.name}</div>
                </div>
            `,t.appendChild(o)})}catch(e){console.error("Ошибка загрузки библиотеки:",e)}}window.togglePin=async function(t,e){t&&t.stopPropagation(),await U(e),f()};window.openGameModal=function(t){E=t;const e=document.getElementById("show-hidden-accs");e&&(e.checked=!1),v(t),document.getElementById("account-modal").style.display="flex"};window.refreshGameModal=function(){E&&v(E)};function v(t){const e=g.find(i=>i.id===t);if(!e)return;if(e.platform==="Custom"||e.platform==="Torrent"){launch("",e.id,e.platform,e.exePath),document.getElementById("account-modal").style.display="none";return}const n=e.isInstalled?"Launch":"Install",o=e.isInstalled?"fa-play":"fa-download",a=document.getElementById("show-hidden-accs"),s=a?a.checked:!1;document.getElementById("modal-game-title").innerText=`${n} ${e.name}`;const c=document.getElementById("modal-accounts-list");c.innerHTML="",!e.availableOn||e.availableOn.length===0?c.innerHTML=`<div class="modal-item interactable" onclick="launch('', '${e.id}', '${e.platform}', '')">
            <div class="acc-name">${n} Game</div>
            <div class="acc-meta">Current Account (or not logged in)</div>
        </div>`:e.availableOn.forEach(i=>{if(i.isHidden&&!s)return;const l=document.createElement("div");l.className="modal-item",i.isHidden&&l.classList.add("acc-hidden-row");let p="";i.note==="Main"?p='<span class="badge badge-main"><i class="fa-solid fa-crown"></i> MAIN</span>':i.note==="Smurf"?p='<span class="badge badge-smurf"><i class="fa-solid fa-child"></i> SMURF</span>':i.note==="VAC"?p='<span class="badge badge-vac"><i class="fa-solid fa-ban"></i> VAC BAN</span>':i.note&&(p=`<span class="badge badge-custom"><i class="fa-solid fa-note-sticky"></i> ${i.note}</span>`);const I=i.isHidden?"fa-rotate-left":"fa-eye-slash",L=i.isHidden?"toggle-restore-btn":"toggle-hidden-btn",B=i.isHidden?"Restore account":"Hide from this game";l.innerHTML=`
                <div style="flex:1; cursor:pointer;" onclick="launch('${i.username}', '${e.id}', '${e.platform}', '')">
                    <div class="acc-name" style="font-weight:bold; display:flex; align-items:center;">
                        <i class="fa-solid ${o}" style="margin-right:8px; font-size:12px; color:#aaa;"></i>
                        ${i.displayName}
                        ${p}
                    </div>
                    <div class="acc-meta" style="font-size:12px; color:#aaa;">Login: ${i.username}</div>
                </div>
                
                <div class="edit-note-btn" onclick="openNoteSelector('${i.username}', '${e.platform}', '${e.id}', '${i.note||""}')" title="Tag Account">
                    <i class="fa-solid fa-tag"></i>
                </div>
                
                <div class="toggle-hidden-btn ${L}" onclick="toggleGameAccountHidden('${i.username}', '${e.platform}', '${e.id}')" title="${B}">
                    <i class="fa-solid ${I}"></i>
                </div>
            `,c.appendChild(l)})}window.launch=async function(t,e,n,o){try{const a=await C(t,e,n,o);a&&!a.startsWith("Launched")&&!a.startsWith("Success")?alert(a):document.getElementById("account-modal").style.display="none"}catch(a){alert("Launch error: "+a)}};window.toggleGameAccountHidden=async function(t,e,n){await O(t,e,n),g=await b(),v(n)};window.openNoteSelector=function(t,e,n,o){A={username:t,platform:e,gameId:n};const a=["Main","Smurf","VAC"].includes(o);document.getElementById("custom-note-input").value=a?"":o,document.getElementById("note-select-modal").style.display="flex"};window.savePredefinedNote=async function(t){await $(t)};window.saveCustomNote=async function(){const t=document.getElementById("custom-note-input").value;await $(t)};async function $(t){const{username:e,platform:n,gameId:o}=A;await R(e,n,o,t),g=await b(),document.getElementById("note-select-modal").style.display="none",v(o)}async function w(){const t=document.getElementById("launchers-list");if(t){t.innerHTML='<div style="padding:20px">Loading accounts...</div>';try{const e=await M();t.innerHTML="",e.forEach(n=>{const o=document.createElement("div");o.className="launcher-section";let a="";n.accounts.forEach(c=>{let i=`<div class="acc-avatar">${c.displayName.charAt(0)}</div>`;c.avatarUrl&&(i=`<div class="acc-avatar" style="background-image: url('${c.avatarUrl.replace(/\\/g,"/")}'); background-size: cover; color: transparent;"></div>`);const l=c.comment?`<div class="acc-comment">${c.comment}</div>`:"";a+=`
                    <div class="account-row interactable" onclick="switchAccount('${c.username}', '${n.platform}')">
                        ${i}
                        <div class="acc-details">
                            <div class="acc-nick">${c.displayName}${l}</div>
                            <div class="acc-login">${c.username}</div>
                        </div>
                        <div class="acc-actions" onclick="event.stopPropagation()">
                            <div class="action-icon-btn" onclick="openEditAccount('${c.username}', '${n.platform}', '${c.comment||""}')"><i class="fa-solid fa-pen"></i></div>
                            <div class="action-icon-btn delete-btn" onclick="deleteAccount('${c.username}', '${n.platform}')"><i class="fa-solid fa-trash"></i></div>
                        </div>
                        <div class="acc-action-icon"><i class="fa-solid fa-arrow-right-to-bracket"></i></div>
                    </div>`});let s="";o.innerHTML=`
                <div class="launcher-header">
                    <i class="fa-brands fa-${n.platform.toLowerCase()}"></i> ${n.name} 
                    <span class="count">${n.accounts.length}</span>
                </div>
                <div class="launcher-accounts">${a}</div>
                ${s}
            `,t.appendChild(o)})}catch(e){t.innerHTML="Error loading accounts.",console.error(e)}}}window.switchAccount=async function(t,e){const n=await P(t,e);alert(n)};window.deleteAccount=async function(t,e){confirm(`Скрыть аккаунт ${t} из списка?`)&&(await x(t,e),w())};window.openEditAccount=function(t,e,n){h={username:t,platform:e},document.getElementById("edit-comment").value=n,document.getElementById("edit-avatar-path").value="",document.getElementById("edit-account-modal").style.display="flex"};window.selectNewAvatar=async function(){const t=await S();t&&(document.getElementById("edit-avatar-path").value=t)};window.saveAccountChanges=async function(){await D(h.username,h.platform,document.getElementById("edit-comment").value,document.getElementById("edit-avatar-path").value),closeModal("edit-account-modal"),w()};window.browseFile=async function(){const t=await k();t&&(document.getElementById("custom-path").value=t)};window.saveCustomGame=async function(){const t=await G(document.getElementById("custom-name").value,document.getElementById("custom-path").value);t==="Success"?(closeModal("add-game-modal"),f(),document.getElementById("custom-name").value="",document.getElementById("custom-path").value=""):alert(t)};window.addEpicAccount=function(){let t=prompt("Введите название для текущего аккаунта Epic Games (убедитесь, что вы залогинены):","Main Profile");t&&T(t).then(e=>{e==="Success"?(alert("Аккаунт Epic успешно сохранен!"),document.getElementById("view-accounts").style.display!=="none"&&w()):alert("Ошибка сохранения: "+e)}).catch(e=>{console.error(e),alert("Системная ошибка: "+e)})};const d=document.getElementById("context-menu"),r=document.getElementById("ctx-delete"),u=document.getElementById("ctx-change-icon");document.addEventListener("click",()=>{d&&(d.style.display="none")});document.addEventListener("contextmenu",t=>{const e=t.target.closest(".card");if(e){if(t.preventDefault(),y=e.getAttribute("data-id"),m=e.getAttribute("data-platform"),m==="Torrent"||m==="Custom")r&&(r.style.display="block"),u&&(u.style.display="block");else if(r&&(r.style.display="none"),u&&(u.style.display="none"),!r&&!u){d.style.display="none";return}d.style.top=`${t.pageY}px`,d.style.left=`${t.pageX}px`,d.style.display="block"}else d&&(d.style.display="none")});r&&r.addEventListener("click",async()=>{if(!(!y||!m||!confirm("Удалить эту игру из библиотеки?")))try{const e=await H(y,m);e==="Success"?f():alert("Ошибка: "+e)}catch(e){console.error(e)}});u&&u.addEventListener("click",async()=>{if(!y||!m)return;const t=await N(y,m);t&&!t.startsWith("Error")&&t!=="Cancelled"&&t!=="Not supported for this platform"?f():t&&t.startsWith("Error")&&alert(t)});
