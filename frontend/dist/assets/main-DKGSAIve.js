(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))i(o);new MutationObserver(o=>{for(const c of o)if(c.type==="childList")for(const a of c.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&i(a)}).observe(document,{childList:!0,subtree:!0});function n(o){const c={};return o.integrity&&(c.integrity=o.integrity),o.referrerPolicy&&(c.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?c.credentials="include":o.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function i(o){if(o.ep)return;o.ep=!0;const c=n(o);fetch(o.href,c)}})();function L(e,t){return window.go.app.App.AddCustomGame(e,t)}function x(e,t){return window.go.app.App.DeleteAccount(e,t)}function G(){return window.go.app.App.GetLaunchers()}function E(){return window.go.app.App.GetLibrary()}function M(e,t,n,i){return window.go.app.App.LaunchGame(e,t,n,i)}function S(e,t){return window.go.app.App.RemoveGame(e,t)}function H(e){return window.go.app.App.SaveEpicAccount(e)}function k(){return window.go.app.App.SelectExe()}function C(){return window.go.app.App.SelectImage()}function T(e,t){return window.go.app.App.SetGameImage(e,t)}function N(e,t){return window.go.app.App.SwitchToAccount(e,t)}function P(e,t,n){return window.go.app.App.ToggleGameAccountHidden(e,t,n)}function U(e){return window.go.app.App.ToggleGamePin(e)}function O(e,t,n,i){return window.go.app.App.UpdateAccountData(e,t,n,i)}function R(e,t,n,i){return window.go.app.App.UpdateGameNote(e,t,n,i)}let g=[],b={username:"",platform:"",gameId:""},w={username:"",platform:""},h="",p=null,d=null;window.switchTab=function(e){document.querySelectorAll(".view-section").forEach(t=>t.style.display="none"),document.querySelectorAll(".nav-item").forEach(t=>t.classList.remove("active")),e==="library"?(document.getElementById("view-library").style.display="block",m()):(document.getElementById("view-accounts").style.display="block",v())};window.closeModal=function(e){document.getElementById(e).style.display="none"};window.openAddGameModal=function(){document.getElementById("add-game-modal").style.display="flex"};async function m(){const e=document.getElementById("games-grid"),t=await E();g=t,e.innerHTML="",t.length||(e.innerHTML="No games found."),t.forEach(n=>{const i=document.createElement("div");i.className="card",n.isInstalled||i.classList.add("game-not-installed"),i.setAttribute("data-id",n.id),i.setAttribute("data-platform",n.platform),i.onclick=()=>openGameModal(n.id);let o="#0074e4";n.platform==="Steam"&&(o="#1b2838"),n.platform==="Epic"&&(o="#333"),n.platform==="Custom"&&(o="#2d8c58");let c="https://via.placeholder.com/300x169?text="+encodeURIComponent(n.name);n.iconUrl&&(c=n.iconUrl.replace(/\\/g,"/"));const s=`<div class="pin-btn ${n.isPinned?"active":""}" onclick="window.togglePin(event, '${n.id}')"><i class="fa-solid fa-thumbtack"></i></div>`;let l="";n.isInstalled||(l='<div class="install-overlay"><i class="fa-solid fa-download"></i></div>'),i.innerHTML=`
            <div class="platform-badge" style="background:${o}">${n.platform}</div>
            ${s}
            ${l}
            <img src="${c}" class="card-img" style="height:150px; width:100%; object-fit:cover;">
            <div class="card-info"><div class="game-title" style="font-weight:bold;">${n.name}</div></div>
        `,e.appendChild(i)})}window.togglePin=async function(e,t){e.stopPropagation(),await U(t),m()};window.openGameModal=function(e){h=e,document.getElementById("show-hidden-accs").checked=!1,y(e),document.getElementById("account-modal").style.display="flex"};window.refreshGameModal=function(){h&&y(h)};function y(e){const t=g.find(a=>a.id===e);if(!t)return;if(t.platform==="Custom"){launch("",t.id,t.platform,t.exePath),document.getElementById("account-modal").style.display="none";return}const n=t.isInstalled?"Launch":"Install",i=t.isInstalled?"fa-play":"fa-download",o=document.getElementById("show-hidden-accs").checked;document.getElementById("modal-game-title").innerText=`${n} ${t.name}`;const c=document.getElementById("modal-accounts-list");c.innerHTML="",!t.availableOn||t.availableOn.length===0?c.innerHTML=`<div class="modal-item" onclick="launch('', '${t.id}', '${t.platform}', '')">
            <div class="acc-name">${n} Game</div><div class="acc-meta">Current Account</div>
        </div>`:t.availableOn.forEach(a=>{if(a.isHidden&&!o)return;const s=document.createElement("div");s.className="modal-item",a.isHidden&&s.classList.add("acc-hidden-row");let l="";a.note==="Main"?l='<span class="badge badge-main"><i class="fa-solid fa-crown"></i> MAIN</span>':a.note==="Smurf"?l='<span class="badge badge-smurf"><i class="fa-solid fa-child"></i> SMURF</span>':a.note==="VAC"?l='<span class="badge badge-vac"><i class="fa-solid fa-ban"></i> VAC BAN</span>':a.note&&(l=`<span class="badge badge-custom"><i class="fa-solid fa-note-sticky"></i> ${a.note}</span>`);const $=a.isHidden?"fa-rotate-left":"fa-trash",I=a.isHidden?"toggle-restore-btn":"toggle-hidden-btn",B=a.isHidden?"Restore account":"Remove from list";s.innerHTML=`
                <div style="flex:1" onclick="launch('${a.username}', '${t.id}', '${t.platform}', '')">
                    <div class="acc-name" style="font-weight:bold; display:flex; align-items:center;">
                        <i class="fa-solid ${i}" style="margin-right:8px; font-size:12px; color:#aaa;"></i>
                        ${a.displayName}
                        ${l}
                    </div>
                    <div class="acc-meta" style="font-size:12px; color:#aaa;">Login: ${a.username}</div>
                </div>
                <div class="edit-note-btn" onclick="openNoteSelector('${a.username}', '${t.platform}', '${t.id}', '${a.note||""}')" title="Tag Account">
                    <i class="fa-solid fa-tag"></i>
                </div>
                <div class="toggle-hidden-btn ${I}" onclick="toggleGameAccountHidden('${a.username}', '${t.platform}', '${t.id}')" title="${B}">
                    <i class="fa-solid ${$}"></i>
                </div>
            `,c.appendChild(s)})}window.toggleGameAccountHidden=async function(e,t,n){await P(e,t,n),g=await E(),y(n)};window.launch=async function(e,t,n,i){const o=await M(e,t,n,i);o&&!o.startsWith("Launched")&&!o.startsWith("Success")?alert(o):document.getElementById("account-modal").style.display="none"};window.openNoteSelector=function(e,t,n,i){b={username:e,platform:t,gameId:n};const o=["Main","Smurf","VAC"].includes(i);document.getElementById("custom-note-input").value=o?"":i,document.getElementById("note-select-modal").style.display="flex"};window.savePredefinedNote=async function(e){await A(e)};window.saveCustomNote=async function(){const e=document.getElementById("custom-note-input").value;await A(e)};async function A(e){const{username:t,platform:n,gameId:i}=b;await R(t,n,i,e),g=await E(),document.getElementById("note-select-modal").style.display="none",y(i)}async function v(){const e=document.getElementById("launchers-list");e.innerHTML='<div style="padding:20px">Loading accounts...</div>';const t=await G();e.innerHTML="",t.forEach(n=>{const i=document.createElement("div");i.className="launcher-section";let o="";n.accounts.forEach(a=>{let s=`<div class="acc-avatar">${a.displayName.charAt(0)}</div>`;a.avatarUrl&&(s=`<div class="acc-avatar" style="background-image: url('${a.avatarUrl.replace(/\\/g,"/")}'); background-size: cover; color: transparent;"></div>`);const l=a.comment?`<div class="acc-comment">${a.comment}</div>`:"";o+=`
                <div class="account-row interactable" onclick="switchAccount('${a.username}', '${n.platform}')">
                    ${s}
                    <div class="acc-details">
                        <div class="acc-nick">${a.displayName}${l}</div>
                        <div class="acc-login">${a.username}</div>
                    </div>
                    <div class="acc-actions" onclick="event.stopPropagation()">
                        <div class="action-icon-btn" onclick="openEditAccount('${a.username}', '${n.platform}', '${a.comment||""}')"><i class="fa-solid fa-pen"></i></div>
                        <div class="action-icon-btn delete-btn" onclick="deleteAccount('${a.username}', '${n.platform}')"><i class="fa-solid fa-trash"></i></div>
                    </div>
                    <div class="acc-action-icon"><i class="fa-solid fa-arrow-right-to-bracket"></i></div>
                </div>`});let c="";n.platform==="Epic"&&(c='<div style="padding:10px; text-align:center; border-top:1px solid #2a2a2a;"><button onclick="openSaveEpicModal()" style="background:transparent; border:1px dashed #444; color:#888; width:100%; padding:8px; cursor:pointer;"><i class="fa-solid fa-plus"></i> Save Current Epic Account</button></div>'),i.innerHTML=`<div class="launcher-header"><i class="fa-brands fa-${n.platform.toLowerCase()}"></i> ${n.name} <span class="count">${n.accounts.length}</span></div><div class="launcher-accounts">${o}</div>${c}`,e.appendChild(i)})}window.switchAccount=async function(e,t){alert(await N(e,t))};window.openSaveEpicModal=function(){document.getElementById("epic-save-name").value="",document.getElementById("save-epic-modal").style.display="flex"};window.doSaveEpic=async function(){const e=document.getElementById("epic-save-name").value;e&&(alert(await H(e)),closeModal("save-epic-modal"),v())};window.deleteAccount=async function(e,t){confirm(`Hide account ${e}?`)&&(await x(e,t),v())};window.openEditAccount=function(e,t,n){w={username:e,platform:t},document.getElementById("edit-comment").value=n,document.getElementById("edit-avatar-path").value="",document.getElementById("edit-account-modal").style.display="flex"};window.selectNewAvatar=async function(){const e=await C();e&&(document.getElementById("edit-avatar-path").value=e)};window.saveAccountChanges=async function(){await O(w.username,w.platform,document.getElementById("edit-comment").value,document.getElementById("edit-avatar-path").value),closeModal("edit-account-modal"),v()};window.browseFile=async function(){const e=await k();e&&(document.getElementById("custom-path").value=e)};window.saveCustomGame=async function(){const e=await L(document.getElementById("custom-name").value,document.getElementById("custom-path").value);e==="Success"?(closeModal("add-game-modal"),m(),document.getElementById("custom-name").value="",document.getElementById("custom-path").value=""):alert(e)};const r=document.getElementById("context-menu"),f=document.getElementById("ctx-delete"),u=document.getElementById("ctx-change-icon");document.addEventListener("click",()=>{r&&(r.style.display="none")});document.addEventListener("contextmenu",e=>{const t=e.target.closest(".card");t?(e.preventDefault(),p=t.getAttribute("data-id"),d=t.getAttribute("data-platform"),d!=="Torrent"&&d!=="Custom"?(f.style.display="none",u&&(u.style.display="none")):(f.style.display="block",u&&(u.style.display="block")),r.style.top=`${e.pageY}px`,r.style.left=`${e.pageX}px`,r.style.display="block"):r.style.display="none"});f&&f.addEventListener("click",async()=>{if(!(!p||!d||!await confirm("Удалить эту игру?")))try{const t=await S(p,d);t==="Success"?m():alert("Ошибка: "+t)}catch(t){console.error(t)}});u&&u.addEventListener("click",async()=>{if(!p||!d)return;const e=await T(p,d);e&&!e.startsWith("Error")&&e!=="Cancelled"&&e!=="Not supported for this platform"?m():e&&e.startsWith("Error")&&alert(e)});m();
